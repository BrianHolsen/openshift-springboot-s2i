apiVersion: v1
kind: Template
metadata:
  creationTimestamp: null
  name: springboot-app
  annotations:
    description: "SpringBoot application" 
    tags: "java,springboot"   
  
objects:

apiVersion: v1
kind: ImageStream
metadata:
  name: openshift-springboot-s2i
  namespace: ${APPLICATION_NAME}
spec:
  dockerImageRepository: veretie/openshift-springboot-s2i

- apiVersion: v1
  kind: BuildConfig
  metadata:
    creationTimestamp: null
  spec:
    output:
      to:
        kind: ImageStreamTag
        name: ${APPLICATION_NAME}-bc:latest
    postCommit: {}
    resources: {}
    runPolicy: Serial
    source:
      git:
        ref: ${SOURCE_REPOSITORY_BRANCH}
        uri: ${SOURCE_REPOSITORY_URL}
      type: Git
    strategy:
      sourceStrategy:
        from:
          kind: ImageStreamTag
          name: openshift-springboot-s2i:latest
          namespace: ${APPLICATION_NAME}
      type: Source
    triggers:
    - imageChange: {}
      type: ImageChange
    - type: ConfigChange

kind: "DeploymentConfig"
apiVersion: "v1"
metadata:
  name: ${APPLICATION_NAME}-dc
spec:
  template: 
    metadata:
      labels:
        name: ${APPLICATION_NAME}-rc
    spec:
      containers:
        - name: ${APPLICATION_NAME}
  replicas: 1 
  selector:
    name: ${APPLICATION_NAME}-dc
  triggers:
    - type: "ConfigChange" 
    - type: "ImageChange" 
      imageChangeParams:
        automatic: true
        containerNames:
          - ${APPLICATION_NAME}
        from:
          kind: "ImageStreamTag"
          name: ${APPLICATION_NAME}-bc:latest
  strategy: 
    type: "Rolling"	
	
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: ${APPLICATION_NAME}-route
  spec:
    host: ${APPLICATION_URL_PREFIX}.10.2.2.2.xip.io
    to:
      kind: Service
      name: ${APPLICATION_NAME}-service
      weight: 100

- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    name: ${APPLICATION_NAME}-service
  spec:
    ports:
    - port: ${APPLICATION_PORT}
      protocol: TCP
      targetPort: ${APPLICATION_PORT}
    selector:
      deploymentconfig: ${APPLICATION_NAME}-dc
    sessionAffinity: None
    type: ClusterIP

parameters:
  - name: APPLICATION_NAME 
    description: The name of application 
    value: prime-numbers
    required: true 
  - name: APPLICATION_PORT
    description: The port of application 
    value: 8081
    required: true 
  - name: APPLICATION_URL_PREFIX
    description: The URL of application to be mapped 
    value: prime.numbers
    required: true 	
  - name: SOURCE_REPOSITORY_URL 
    description: The URL of the repository with your application source code 
    value: https://github.com/veretie/prime-numbers.git
    required: true 
  - name: SOURCE_REPOSITORY_BRANCH
    description: Git branch
    value: develop
    required: true 	

